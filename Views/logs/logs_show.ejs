<!DOCTYPE html>
<html lang="en" view-transition>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Event logs</title>

    <link rel="shortcut icon" href="/favico.png">
    <link rel="stylesheet" href="/logs/logs_show.css">

</head>
<body class="entire-page">

    <%
        const { logs = [], sessions = [] } = locals
        const { USER_TYPES = {} } = locals.config || {}
    %>

    <%- include("../__header.ejs") %>


    <main class="standard-template logs">
        
        <h1 class="main-title">Currently in the system (<%= sessions.length %>)</h1>

        <table class="standart-table sessions-table">
            <thead>
                <tr>
                    <th scope="col">Role</th>
                    <th scope="col">Status</th>
                    <th scope="col">First name</th>
                    <th scope="col">Username</th>
                    <th scope="col">Email</th>
                    <th scope="col">Expires</th>
                </tr>
            </thead>
            <tbody>
                <% sessions.forEach(({
                    _id, role, status, firstName,
                     username, email, expires }) => { %>
                    <tr>
                        <td><%= USER_TYPES[role] || "??" %> <%= role %></td>
                        <td><%= status %></td>
                        <td><%= firstName %></td>
                        <td><%= username %></td>
                        <td><%= email %></td>
                        <td><%- tools.localDateTime(expires, "html") %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>

        <br>

        <h2 class="main-title">Event logs (<%= logs.length %>)</h2>

        <table class="standart-table logs-table">
            <thead>
                <tr>
                    <th scope="col">Level</th>
                    <th scope="col">Timestamp</th>
                    <th scope="col">Message</th>
                </tr>
            </thead>
            <tbody>
                <% logs.forEach(({ level, message, createdAt }) => {

                    const LEVEL = {
                        ico: "âš ï¸",
                        title: level
                    }
                    if (message.includes("[Logger]")) {
                        LEVEL.ico = "ðŸŸ¢"
                        LEVEL.title = "Connected to Mango"
                    } else if (message.includes("Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾")) {
                        LEVEL.ico = "ðŸš€"
                        LEVEL.title = "Server Reloaded"
                    } else if (message.includes("WATCH")) {
                        LEVEL.ico = "ðŸ§ª"
                        LEVEL.title = "SSE Watcher"
                    } else if (message.includes("Report")) {
                        LEVEL.ico = "ðŸ“˜"
                        LEVEL.title = "Report"
                    } else if (message.includes("warehouse") || message.includes("stock")) {
                        LEVEL.ico = "ðŸª"
                        LEVEL.title = "Warehouse"
                    } else if (message.length > 100) {
                        LEVEL.ico = "âŒ"
                        LEVEL.title = "System Issue"
                    } else if (level === "info") {
                        LEVEL.ico = "ðŸ”¹"
                        LEVEL.title = "Info"
                    }

                    const levelTitle = `${ LEVEL.ico } ${ LEVEL.title }`
                    const parts = message.match(/^(.*?)(\{.*\})?$/) || []
                    const part1 = parts[1] || "empty"
                    
                    let part2 = parts[2]
                    if (part2) try {
                        part2 = JSON.stringify(JSON.parse(part2), null, 2)
                    } catch(e) {
                        part2 += `, error: ${ e }`
                    }

                    %>

                    <tr data-level="<%= level %>" data-type="<%= LEVEL.ico %>">
                        <td class="level"><%= levelTitle %></th>
                        <td class="timestamp"><%- tools.localDateTime(createdAt, "html") %></th>
                        <td class="message">
                            <span><%- part1 %></span>
                            <pre><%= part2 %></pre>
                        </th>
                    </tr>

                <% }) %>
            </tbody>
        </table>

    </main>

    
    <!-- 

    âœ… Info / Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ð¹Ð½Ñ– Ð»Ð¾Ð³Ð¸
        â„¹ï¸ \u2139 â€” ÐºÐ»Ð°ÑÐ¸Ñ‡Ð½Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ
        ðŸ“˜ â€” Ð´Ð¾Ð²Ñ–Ð´ÐºÐ° Ð°Ð±Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ñ–Ñ
        ðŸŸ¢ â€” Ð·ÐµÐ»ÐµÐ½Ð¸Ð¹ Ñ–Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ñ–
        ðŸ’¡ â€” ÐºÐ¾Ñ€Ð¸ÑÐ½Ð° Ð¿Ñ–Ð´ÐºÐ°Ð·ÐºÐ°

    âŒ Error / ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ¸
        âŒ â€” Ð·Ð²Ð¸Ñ‡Ð°Ð¹Ð½Ð° Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ°
        ðŸ›‘ â€” ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð° Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ°
        ðŸ”´ â€” Ñ‡ÐµÑ€Ð²Ð¾Ð½Ð¸Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ
        ðŸš« â€” Ð·Ð°Ð±Ð¾Ñ€Ð¾Ð½Ð° Ð°Ð±Ð¾ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ
        âš ï¸ â€” Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð¶ÐµÐ½Ð½Ñ (Ð¼Ð¾Ð¶Ðµ Ð±ÑƒÑ‚Ð¸ Ñ– Ð´Ð»Ñ warnings)

    ðŸ’¥ System Error / Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ– Ñ„Ð°Ñ‚Ð°Ð»ÑŒÐ½Ñ– Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸
        ðŸ’¥ â€” Ð²Ð¸Ð±ÑƒÑ… / Ñ„Ð°Ñ‚Ð°Ð»ÑŒÐ½Ð¸Ð¹ ÐºÑ€Ð°Ñˆ
        ðŸ’£ â€” ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð²Ð¿Ð°Ð»Ð°
        ðŸ§¨ â€” Ñ‰Ð¾ÑÑŒ Ð¿Ñ–ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº Ð´ÑƒÐ¶Ðµ ÑÐµÑ€Ð¹Ð¾Ð·Ð½Ð¾
        ðŸž â€” Ð±Ð°Ð³
        ðŸ‘¾ â€” Ñ‰Ð¾ÑÑŒ Ð½ÐµÐ¿ÐµÑ€ÐµÐ´Ð±Ð°Ñ‡ÑƒÐ²Ð°Ð½Ðµ

    ðŸ”§ Ð‘Ð¾Ð½ÑƒÑ: Ñ–Ð½ÑˆÑ– ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ñ–Ñ—
        ðŸ§ª Ð¢ÐµÑÑ‚ / Ð´ÐµÐ±Ð°Ð³
        ðŸ› Warning (Ð½Ðµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð°, Ð°Ð»Ðµ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ°)
        ðŸ“¦ Ð—Ð°Ð¿Ð¸Ñ‚ Ð´Ð¾ API Ð°Ð±Ð¾ Ð¼ÐµÑ€ÐµÐ¶Ñ–
        ðŸ•’ Ð¢Ð°Ð¹Ð¼ÐµÑ€ Ð°Ð±Ð¾ Ñ‡Ð°Ñ
        ðŸ§  Ð›Ð¾Ð³Ñ–ÐºÐ° / Ð°Ð½Ð°Ð»Ñ–Ñ‚Ð¸ÐºÐ°

    -->


    <%- include("../__footer.ejs") %>


</body>
</html>