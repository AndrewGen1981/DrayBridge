<!DOCTYPE html>
<html lang="en" view-transition>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Password Update</title>
    <meta name="action" content="must-update-password">

    <link rel="shortcut icon" href="/favico.png">
    <link rel="stylesheet" href="/must_update_password.css">
    
</head>
<body class="entire-page">

    <%
        const { username, firstName } = locals.user || {}
        const name = tools.smartCapitalize(firstName || username)
    %>

    <%- include("__header.ejs") %>

    <%- include("__components/Confetti.ejs") %>

    <main class="standard-template must-update-password">

        <article>
            <h2><strong>Welcome <%= name %></strong>. It looks like you logged in with a <strong>temporary password</strong>. A one-time code has been sent to your <strong>phone</strong>, and to prevent security issues, it <strong>must be changed</strong>.</h2>
            <p>üîê You can create your own password using the following rules:</p>
            <ul>
                <li>at least one<strong id="uppercase">uppercase</strong>and one<strong id="lowercase">lowercase</strong>Latin letter,</li>
                <li>any number of<strong id="digits">digits</strong>(more than one),</li>
                <li>minimum length of<strong id="length">8 characters</strong>(25 max).</li>
            </ul>
            <p>Or simply use a password automatically generated by your device.</p>
            <p>As you type, the form will guide you and let you know if your <strong>password meets the requirements</strong>.</p>
        </article>

        <%- include("__user_basic_profile.ejs") %>
        
    </main>

    <%- include("__footer.ejs") %>

    <script>
        let timeout
        
        const newPassword = document.getElementById("new_password")
        if (newPassword) newPassword.addEventListener("input", () => {
            clearTimeout(timeout)
            setTimeout(() => {
                for (const [id, regEx] of Object.entries({
                    digits: /\d/, uppercase: /[A-Z]/,
                    lowercase: /[a-z]/, length: /^.{8,25}$/
                })) { highlightById(id, regEx) }
            }, 500)
        })

        function highlightById(id, regEx = /./) {
            const item = document.getElementById(id)
            if (!item || !newPassword) return
            const result = regEx.test(newPassword.value)
            newPassword.value?.length
                ? item.dataset.valid = result
                : item.removeAttribute("data-valid")
            return result
        }
    </script>
    
</body>
</html>